<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 2 页 | 张裕的博客</title>
  <meta name="author" content="feiyuw">
  
  <meta name="description" content="Test Automation, Continuous Delivery, Node.js, Python and VIM">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="张裕的博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="张裕的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">张裕的博客</a></h1>
  <h2><a href="/">大音希声，大象希行</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">存档</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-17T07:02:03.000Z"><a href="/2014/08/17/臭豆腐/">2014-08-17</a></time>
      
      
  
    <h1 class="title"><a href="/2014/08/17/臭豆腐/">臭豆腐</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;一直想写一篇关于臭豆腐的文章，但是就像很多人第一次吃臭豆腐的纠结一样，笔者迟迟没有定下标题，定下大意，也就一直没有落笔。直到最近看了一篇汪曾琪先生写的散文《五味》。</p>
<p>&emsp;&emsp;汪曾琪先生的作品是那个时代的作家里面为数不多的我认为值得一读的之一，其他的有曹禹的话剧、鲁迅的《故事新编》等。想想汪老的一生，从南到北，从东到西，历经民国、抗战、解放战争、文革以及文革后的各个时期，挨过批斗，受过饥荒，然而读他的作品，里面流露的总是恬静和平和，看他描写各地的美食，有时仿佛能看到一个老人的顽童心性。他的作品，往往描写一些生活细节，写什么就是什么，我又何必纠结于什么大意和主题呢？</p>
<p>&emsp;&emsp;汪老在《五味》里面对于中国人的吃臭的口味有一段描写，摘录如下： </p>
<p><em>我不知道世界上还有什么国家的人爱吃臭。</em><br><em>过去上海、南京、汉口都卖油炸臭豆腐干。长沙火宫殿的臭豆腐因为一个大人物年轻时常吃而出名。这位大人物后来还去吃过，说了一句话：“火宫殿的臭豆腐还是好吃。”文化大革命中火宫殿的影壁上就出现了两行大字：</em></p>
<p><em>最高指示：</em><br><em>火宫殿的臭豆腐还是好吃。</em></p>
<p><em>我们一个同志到南京出差，他的爱人是南京人，嘱咐他带一点臭豆腐干回来。他千方百计，居然办到了。带到火车上，引起一车厢的人强烈抗议。</em><br><em>除豆腐干外，面筋、百叶（千张）皆可臭。蔬菜里的莴苣、冬瓜、豇豆皆可臭。冬笋的老根咬不动，切下来随手就扔进臭坛子里。我们那里很多人家都有个臭坛子，一坛子“臭卤”。腌芥菜挤下的汁放几天即成“臭卤”。臭物中最特殊的是臭苋菜杆。苋菜长老了，主茎可粗如拇指，高三四尺，截成二寸许小段，入臭坛。臭熟后，外皮是硬的，里面的芯成果冻状。嚼住一头，一吸，芯肉即入口中。这是佐粥的无上妙品。我们那里叫做“苋菜秸子”，湖南人谓之“苋菜咕”，因为吸起来“咕”的一声。</em><br><em>北京人说的臭豆腐指臭豆腐乳。过去是小贩沿街叫卖的：</em><br><em>“臭豆腐，酱豆腐，王致和的臭豆腐。”臭豆腐就贴饼子，熬一锅虾米皮白菜汤，好饭！现在王致和的臭豆腐用很大的玻璃方瓶装，很不方便，一瓶一百块，得很长时间才能吃完，而且卖得很贵，成了奢侈品。我很希望这种包装能改进，一器装五块足矣。</em><br><em>我在美国吃过最臭的“气死”（干酪），洋人多闻之掩鼻，对我说起来实在没有什么，比臭豆腐差远了。</em><br><em>甚矣，中国人口味之杂也，敢说堪为世界之冠。</em></p>
<p>&emsp;&emsp;确实，对于老外来说，臭豆腐这种食物实在太奇特了，以至于常常会怀疑第一个尝试吃它的人是一种什么心态。我特地在百度百科查了一下臭豆腐的由来，传说如下：</p>
<p><em>相传清朝康熙八年，由安徽黄山来京赶考的王致和金榜落第，闲居在会馆中，欲返归故里，交通不便，盘缠皆无，欲在京攻读，准备再次应试，又距下科试期甚远。无奈，只得在京暂谋生计。王致和的家庭原非富有，其父在家乡开设豆腐坊，王致和幼年曾学过做豆腐，于是便在安徽会馆附近租赁了几间房，购置了一些简单的用具，每天磨上几升豆子的豆腐，沿街叫卖。时值夏季，有时卖剩下的豆腐很快发霉，无法食用，但又不甘心废弃。他苦思对策，就将这些豆腐切成小块，稍加晾晒，寻得一口小缸，用盐腌了起来，之后歇伏停业，一心攻读，渐渐地便把此事忘了。</em><br><em>秋风飒爽，王致和又想重操旧业，再做豆腐来卖。蓦地想起那缸腌制的豆腐，赶忙打开缸盖，一股臭气扑鼻而来，取出一看，豆腐已呈青灰色，用口尝试，觉得臭味之余却蕴藏着一股浓郁的香气，虽非美味佳肴，却也耐人寻味，送给邻里品尝，都称赞不已。</em><br><em>王致和屡试不中，只得弃学经商，按过去试做的方法加工起臭豆腐来。此物价格低廉，可以佐餐下饭，适合收入低的劳动人食用，所以渐渐打开销路，生意日渐兴隆。后经辗转筹措，在延寿街中间路西购置了一所铺面房，自产自销，批零兼营。据其购置房屋的契约所载，时为康熙十七年冬。从王致和创造了独一无二的臭豆腐以后，又经多次改进，逐渐摸索出一套臭豆腐的生产工艺，生产规模不断扩大，质量更好，名声更高。清朝末叶，传入宫廷。传说慈禧太后在秋末冬初也喜欢吃它，还将其列为御膳小菜，但嫌其名称不雅，按其青色方正的特点，取名“青方”。</em></p>
<p>&emsp;&emsp;此传说真假已很难考据，不过从中大体可以看出中国很多特色美食（如皮蛋、如捆蹄）的一个发明特点：从失误中来，由平民中来。而为了推广，又往往会附会上皇家贡品，往往都与慈禧、乾隆、康熙搭点边，这里面的例子如苏州的松鹤楼、常州的萝卜干以及这个臭豆腐。</p>
<p>&emsp;&emsp;不负责任地YY一下，吃臭豆腐有时也能体现一个人的行为偏好，在大家都不知道这个东西味道如何的时候，第一个尝试的人往往具有开拓精神，适合创业；在有人称赞，有人贬低的时候，不盲从而去尝试一下的人，往往更务实和独立。</p>
<p>&emsp;&emsp;我也喜欢吃臭豆腐，但什么时候开始吃已经记不得了，小时候吃臭豆腐的记忆都是卖豆腐的师傅的自行车上的一个小桶。一毛钱一块，买上十几块就可以烧一盆了。</p>
<p>&emsp;&emsp;我差不多从小到大一直买的同一个人的豆腐。</p>
<p>&emsp;&emsp;这个卖豆腐的师傅比我爸大个几岁，从我记事起每天就骑着一辆28寸的大自行车走村窜巷。他的自行车后架上做了个支架，两边各挂一个大桶，上面垒两个木格，木桶里面冬、春、秋三季卖的是豆腐，夏季卖的是豆腐脑和凉粉。木格里面冬、春、秋三季多是百叶和豆腐干，夏季则搁上一桶臭豆腐。那时候每年暑假，早晨听到外面“卖豆腐”的叫卖声，我便会抓起一个搪瓷盆飞快地跑出门去，买上2块钱臭豆腐，或是3毛钱豆腐脑，作菜或是烧汤，夏日的一天都会觉得清爽。</p>
<p>&emsp;&emsp;这个臭豆腐买了十几个暑假，直到我大学时候。最后一次在这个师傅那里买臭豆腐是我大二的暑假了，那时候他已经很少做豆腐卖豆腐了，年龄大了，生活也好了，那一次我买完豆腐，跟他聊了好久，他的儿子在烟草公司工作，家里开了家香烟店，经济状况看的出来已经很不错了。临了他跟我说：“我今年已经不卖豆腐了，但是现在暑假了，想想你也该回家了，就出来转转。”</p>
<p>&emsp;&emsp;后来搬家了，我再也没有见过他。</p>
<p>&emsp;&emsp;这是一个很好的人，亦如他做的盐卤豆腐。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-11T01:46:27.000Z"><a href="/2014/08/11/书评：颠覆笑傲江湖、动物农场、伐清、大教堂与市集/">2014-08-11</a></time>
      
      
  
    <h1 class="title"><a href="/2014/08/11/书评：颠覆笑傲江湖、动物农场、伐清、大教堂与市集/">书评：颠覆笑傲江湖、动物农场、伐清、大教堂与市集</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;最近一个月看了几本书，有网络小说，如《伐清》、《颠覆笑傲江湖》，有讽刺小说，如《动物农场》，还有开源运动的经典书籍《大教堂与市集》。这里写一些简单的书评，权当回顾吧。</p>
<h2 id="伐清：灰熊猫的明清历史观点">伐清：灰熊猫的明清历史观点</h2>
<p>&emsp;&emsp;总的来讲，《伐清》是一本还不错的网络小说，如果没有看过《窃明》和《虎狼》，这本书会带给你明末清初历史的很多新奇的视角。作者以全新的视角来探讨南明王朝逆袭的可能性，并且以通俗的方式揭示帝国主义的一些行为准则。不过从整体情节来讲，个人认为不如《窃明》，但也值得一看。这里摘录其中的一段。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>“提督，”在战争的前夜，任堂突然又问邓名道：“帝国的意思，是不是就是强盗？”

“当然不是，”邓名没想到任堂居然会有这么荒唐的念头，大不以为然地问道：“你怎么会有这样的想法？”

“提督教导军官们要为了钱而打仗——这不就是强盗嘛，然后说这样的强盗军队就叫帝国部队；
提督计划建立一个强盗分赃会，打算把它命名为帝国议会；而所有强盗都要遵守的规矩，就叫帝国宪法。”
任堂已经考虑了这个问题好几天了，他自信地说道：“那帝国不就是强盗的意思嘛。”
</pre></td></tr></table></figure>

<h2 id="颠覆笑傲江湖：笑傲江湖的月关改进版">颠覆笑傲江湖：笑傲江湖的月关改进版</h2>
<p>&emsp;&emsp;《颠覆笑傲江湖》是月关早期的作品，逻辑比较严密，很多细节处理得比较好，如对营救任我行的描写，个人认为逻辑性上远比金庸的原著严密。应该说这是一部比较奇特的小说，更像是对《笑傲江湖》这部经典的优化和改进。</p>
<h2 id="动物农场：这就是真实的社会主义？">动物农场：这就是真实的社会主义？</h2>
<p>&emsp;&emsp;《动物农场》是乔治·奥维尔的作品，作者以一个农场的动物赶跑农场主自治开始，狠狠地讽刺了一把社会主义的苏联，当然了，对我国人们来讲，里面的很多场景都能带来联想，如特供，如阶级斗争，这里摘录该书的结尾部分。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>但是他们走开还没有超过二十码距离，又骤然站住。好多条嗓子大吵大嚷的喧哗声从农场主宅内传来。
动物们赶回去重又朝窗内张望。没错儿，一场激烈的争吵正在进行中。那里边有破口大骂的，有拍桌子的，
有犀利的目光怀疑对方作弊的，有气急败坏矢口否认的。翻脸的缘起好像是拿破仑和皮尔金顿先生同时都打出一张黑桃<span class="literal">A</span>。
十二条嗓门暴跳如雷地吼叫，声音全都一个样。这下弄明白了，猪们的脸究竟出了什么问题。
敢情动物们从窗外朝里望，目光从猪移到人，再从人移到猪，又重新从猪移到人，要分清哪张脸是猪的，
哪张脸是人的，已经不可能了。
</pre></td></tr></table></figure>

<h2 id="大教堂与市集：拥抱开源">大教堂与市集：拥抱开源</h2>
<p>&emsp;&emsp;《大教堂与市集》是Eric.S.Raymond关于开源运动的一部纲领性大作，他对如火如荼的开源运动做了总结和理论升华，如果你没有接触过开源，或者你的经理正在用某些已经被证实是错误的方式来管理团队，建议他读一下此书，你会有很多收获的。同样摘录一段。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>6.把你的用户当成开发合作者对待，如果想让代码质量快速提升并有效排错，这是最省心的途径。

这种做法的效力很容易被低估，事实上，连我们这些在开源世界里的人，都极大低估了这种做法的效力，
也就是用户越多就越能有效对抗系统的复杂性，直到Linus Torvalds向我们明白地展示这一点。

我想，Linus最聪明和最有价值的成就其实不是构建出一个Linux内核，而是他发明的这种Linux开发模式。
有一次我当面向他表达了这个看法，他笑了，平静地重复了他常说的话：“我基本上是个很懒的人，别人做事，
我得名誉。”像狐狸那样懒，或者像Robert Heinlein曾经描绘的一个很有名的角色，太懒以至于无所不能。
</pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-11T01:19:55.000Z"><a href="/2014/08/11/我家女儿三岁半/">2014-08-11</a></time>
      
      
  
    <h1 class="title"><a href="/2014/08/11/我家女儿三岁半/">我家女儿三岁半</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;女儿已经三岁半了，从老婆怀孕到她出生，再到学会走路，学会说话，去托班上学。这四年多的时间，随着女儿的加入，我们也改变了很多。</p>
<p>&emsp;&emsp;这里就简单记录一件小事吧，权当留作老来幸福的回忆。</p>
<p>&emsp;&emsp;昨天晚上到了睡觉的时间了，女儿跑过去关掉灯，然后趴在我旁边，过了几秒中，她对我说：“爸爸，我睡不着。”。我回答：“睡不着的话坐起来跟爸爸聊聊天吧。”</p>
<p>&emsp;&emsp;然后女儿给我出了个题：“爸爸，给我讲个故事吧？”，“什么故事？”，“大猩猩对付大灰狼的故事”。各位，如果你们碰到这个问题，你们会怎么讲？昨天我是这么编的：</p>
<p>&emsp;&emsp;话说在很久很久以前（故事都是这么开头的不是？其实这是为了给自己多点编故事的时间），那时候是中国的春秋战国时期（有点谱了），在当时的郑国这个地方，生活着一个小宝宝（基本上故事的主角都是小宝宝，当然后来有长大的）。小宝宝经常去家附近的森林里玩，在那里他有一个好朋友，是一只跟他差不多大的小猩猩，他们经常一起玩耍，一起捉迷藏（除了大灰狼，都出来了，后面就好编了）。</p>
<p>&emsp;&emsp;小宝宝和小猩猩慢慢地长大了，他们依然经常在一起玩耍，依然是好朋友，只是见面的次数比以前少了。</p>
<p>&emsp;&emsp;然而这个时候发生了一件事情（故事总得有转折的嘛），郑国开始打仗了，长大后的小宝宝，这个时候要称他为小伙子了。小伙子被抽壮丁抓走了，他们要到很远的地方去与秦国军队打仗（春秋战国时期嘛，当然战争是最容易想到的了）。</p>
<p>&emsp;&emsp;小伙子随着部队来到了郑国的边界，那里的郑国军队正和秦军激烈地战斗。但是他们的加入没有影响战争的走势，郑国还是失败了。小伙子连续跑了好几天，才从战场上逃出来。可这个时候他已经又累又饿，在一个树林里坐下后，一下就睡着了（编得还算圆吧？）。</p>
<p>&emsp;&emsp;也不知道过了多久，小伙子慢慢地醒过来了，心想这个时候怎么可以睡着了呢。他一转身，赫然发现旁边不远处躺着一条大灰狼，已经被打死了，在大灰狼的不远处，有一个巨大而熟悉的身影——那是大猩猩（故事的第一阶段编完了）。</p>
<p>&emsp;&emsp;原来大猩猩发现小伙子被抓走了，就一路跟了过来，正好碰到大灰狼想吃掉睡着的小伙子，大猩猩用他有力的拳头就把大灰狼给打趴下了。</p>
<p>&emsp;&emsp;按照我原先的打算，这个故事到这里就算结束了，这个时候女儿也安安静静地睡在那里，我以为她已经睡着了。可是，可能是看到我没有再讲了，女儿突然说了句：“爸爸，继续讲啊”。好吧，那我继续编。</p>
<p>&emsp;&emsp;小伙子和大猩猩一路躲避着追兵往家走（是不是有点像大兵小将？事实上这个时候我是在琢磨接下来说啥），他们经常隐藏在树林里，等晚上再出来赶路。两个人靠采野果和抓鱼为生，他们通常一个人去采野果，另一个就去抓鱼（是不是像两个人了而不是人和猩猩了？不好编啊）。</p>
<p>&emsp;&emsp;这一天，轮到大猩猩去采野果，小伙子去抓鱼，可是小伙子抓完鱼回来等了好久，还没有看到大猩猩，看来大猩猩多半遇到麻烦了。小伙子沿着树林边缘寻找，发现前面有一大队士兵押着很多大车在往前走，大车上装着很多一些木头笼子，里面关着老虎、犀牛等各种大型动物，当然还有大猩猩。</p>
<p>&emsp;&emsp;小伙子悄悄地跟在队伍后头，准备到晚上找机会救出大猩猩。到了晚上，队伍走到了一个峡谷的入口，他们在这里扎下营寨，把大车围了一圈，阻挡敌人和野兽的袭击。小伙子悄悄地摸到大车旁边，看到每个大木笼都被锁链牢牢地锁住了，小伙子需要找到钥匙才能把木笼打开。可能是天无绝人之路，带着木笼钥匙的那个士兵就睡在木笼的旁边不远处，他的钥匙耷拉在地上，发出阵阵地鼾声。小伙子蹑手蹑脚地走过去，偷偷拿走了钥匙，打开了大猩猩的木笼，然后他又打开了其它的木笼。等到士兵发现动物逃走的时候，他们已经跑出去很远了。</p>
<p>&emsp;&emsp;小伙子和大猩猩千辛万苦回到了家乡，可是家乡已经被秦军占领了，他们只能继续往山里面躲，沿途遇到其他的人和动物，最后，他们在深山里找到了一个盆地，在那里生活了下来（天坑，最近女儿看爸爸去哪儿比较多，这个容易理解）。</p>
<p>&emsp;&emsp;这是我第二次打算结束整个故事，然后女儿又来了一句：“爸爸，接下来怎么样了呢？”，能怎么样呢？接着往下编吧，她怎么还没睡着啊？</p>
<p>&emsp;&emsp;故事的第三段就是桃花源记，有一个渔夫误入桃花源（当然了，就是小伙子、大猩猩以及其他的村民一起逃进去的那个地方），看到这个地方的人们还保留着几百年前的衣着和习惯，才知道他们是躲避战争过来的。渔夫住了几天后告辞，沿途留下记号，报告官府，但是回来找的时候却怎么也找不到了。</p>
<p>&emsp;&emsp;第三段故事结束，回头看女儿已经睡着了。</p>
<p>&emsp;&emsp;最后给各位再出几个题（当然都是女儿给我出的）：</p>
<ul>
<li>小母鸡在大草原上下蛋</li>
<li>小母鸡在沙漠里下蛋</li>
<li>小蛇和大猩猩的故事</li>
</ul>
<p>&emsp;&emsp;期待你们的答案！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-06T06:30:41.000Z"><a href="/2014/08/06/基于gitlab-merge-request的持续集成/">2014-08-06</a></time>
      
      
  
    <h1 class="title"><a href="/2014/08/06/基于gitlab-merge-request的持续集成/">基于gitlab merge request的持续集成</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;Gitlab可以认为是github的开源实现，基于它来构建开发流程可以带给我们类似github的体验，尤其是基于merge request进行测试和代码评审，是开发者间合作的一种很好的方式。本文就谈一下怎么基于gitlab merge request来进行持续集成和工作。</p>
<p>&emsp;&emsp;先谈一下我们用到的工具：</p>
<ul>
<li>Jenkins</li>
<li>git plugin</li>
<li>gitlab merge request builder plugin</li>
</ul>
<p>&emsp;&emsp;然后准备一台Linux的PC用来安装Jenkins就可以了。</p>
<h2 id="第一步：获取Jenkins，启动Jenkins">第一步：获取Jenkins，启动Jenkins</h2>
<ol>
<li>从 <a href="http://jenkins-ci.org" target="_blank" rel="external">http://jenkins-ci.org</a> 上下载最新的jenkins.war文件</li>
<li>java -jar jenkins.war启动Jenkins，可以添加一下启动参数，设置端口和log地址等，如我实际使用的启动脚本如下：<figure class="highlight sh"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash
</span>
<span class="keyword">export</span> JENKINS_HOME=/opt/jenkins_home/
java -Duser.timezone=<span class="string">"Asia/Shanghai"</span> -Dorg.apache.commons.jelly.tags.fmt.timeZone=<span class="string">'Asia/Shanghai'</span> -jar /opt/jenkins_home/jenkins.war --daemon --prefix=/jenkins --logfile=/opt/jenkins_home/logs/jenkins.log
</pre></td></tr></table></figure></li>
<li>打开 <a href="http://localhost:8080/jenkins" target="_blank" rel="external">http://localhost:8080/jenkins</a> 来使用它</li>
</ol>
<h2 id="第二步：安装git_plugin，gitlab_merge_request_builder_plugin">第二步：安装git plugin，gitlab merge request builder plugin</h2>
<ol>
<li>打开 <a href="http://localhost:8080/jenkins/pluginManager/" target="_blank" rel="external">http://localhost:8080/jenkins/pluginManager/</a> 选择Git Plugin和Gitlab Merge Request Builder Plugin，点击安装</li>
<li>重启jenkins</li>
<li>安装完成</li>
</ol>
<h2 id="第三步：全局配置">第三步：全局配置</h2>
<ol>
<li>打开 <a href="http://localhost:8080/jenkins/configure" target="_blank" rel="external">http://localhost:8080/jenkins/configure</a> ，配置<strong>Gitlab Merge Request Builder</strong></li>
<li>设置Gitlab Host URL为你的gitlab服务器地址</li>
<li>设置Jenkins Username，为你登录gitlab服务器的用户名</li>
<li>设置Jenkins API Token，必须和Jenkins Username匹配</li>
<li>其他设置默认就可以了</li>
</ol>
<p><img src="/images/gitlab_global.png" alt="gitlab全局配置"></p>
<h2 id="第四步：配置Job">第四步：配置Job</h2>
<ol>
<li>新建一个job，配置Git，见下图，除了Repository URL，其它照抄就可以了<br> <img src="/images/git_config.png" alt="git config"></li>
<li>配置Gitlab Merge Request Builder，注意设置Gitlab Project Path<br> <img src="/images/gitlab_mr_config.png" alt="gitlab merge request builder"></li>
</ol>
<h2 id="测试">测试</h2>
<ol>
<li>配置好测试的脚本和slave等，然后创建一个merge request，等待Jenkins的自动触发吧</li>
<li>一个配置正确的job，触发的历史记录类似下图<br> <img src="/images/gitlab_mr_builds.png" alt="gitlab builds"></li>
<li>某一个具体的build的触发情况如下图，可以看到触发源是gitlab merge request，源branch和目标branch的信息，以及commit版本信息等<br> <img src="/images/gitlab_mr_build_cause.png" alt="gitlab build detail"></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-06T06:14:45.000Z"><a href="/2014/08/06/工作在持续集成上/">2014-08-06</a></time>
      
      
  
    <h1 class="title"><a href="/2014/08/06/工作在持续集成上/">工作在持续集成上</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;最近这几年一直在与持续集成及其相关的工作打交道，包括我自己的日常工作，目前也在这个工作模式里面进行。这篇博客想通过一天的工作来聊一下这种工作模式，它的优点以及弊端。</p>
<h2 id="什么是持续集成">什么是持续集成</h2>
<p>&emsp;&emsp;摘录自Martin Fowler的<a href="http://www.martinfowler.com/articles/continuousIntegration.html" target="_blank" rel="external">大作</a>：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>Continuous Integration <span class="keyword">is</span> a software development practice <span class="keyword">where</span> members <span class="keyword">of</span> a team integrate their 
work frequently, usually each person integrates <span class="keyword">at</span> least daily - leading <span class="keyword">to</span> multiple integrations 
per <span class="property">day</span>. Each integration <span class="keyword">is</span> verified <span class="keyword">by</span> an automated build (including test) <span class="keyword">to</span> detect integration 
errors <span class="keyword">as</span> quickly <span class="keyword">as</span> possible. Many teams find <span class="keyword">that</span> this approach leads <span class="keyword">to</span> significantly reduced 
integration problems <span class="keyword">and</span> allows a team <span class="keyword">to</span> develop cohesive software more rapidly. This article <span class="keyword">is</span> 
a quick overview <span class="keyword">of</span> Continuous Integration summarizing <span class="keyword">the</span> technique <span class="keyword">and</span> <span class="keyword">its</span> current usage.
</pre></td></tr></table></figure>

<p>&emsp;&emsp;简而言之，持续集成就是让项目团队中的每一个人都尽可能频繁地把他们的工作集成到产品中进行验证，获得反馈的一种工作模式。</p>
<h2 id="在持续集成中工作">在持续集成中工作</h2>
<p>&emsp;&emsp;在这里笔者描述一下一天的工作情况。笔者所在的团队很小，所做的工作以开发内部工具为主，采用gitlab来管理代码和issue，以及进行code review。</p>
<p>&emsp;&emsp;早上到公司，第一件事一般是打开邮箱，查看有没有新的code review请求发过来。如果有的话，会在打开对应的merge request，进行code review，gitlab会自动把这些review结果发送给其他人。处理完这些事情后，如果有未做完的issue，会接着昨天的工作继续开发。如果昨天的issue已经结束并通过review，则会在gitlab上找下一个优先级的issue，将它的assiner改成自己，然后为这个issue创建分支，开始在这个分支上进行开发。</p>
<p>&emsp;&emsp;通常情况下，上午的两三个小时时间主要用在code review和日常的交流回复上面，下午4：00前是主要的开发时间，在本地UT通过后，就会提交到gitlab上。然后创建一个merge request，这个时候CI系统会侦测到这次提交，并自动执行单元测试，代码静态分析等，如果其中一个测试失败，笔者会收到相关的邮件。然后就是修复这些问题，再次提交。</p>
<p>&emsp;&emsp;下班前的半个小时是组内的日常会议时间，主要是交流各自进度和遇到的问题。</p>
<p>&emsp;&emsp;如果所选的issue开发已经结束，并且通过CI系统测试，就会发一个code review的请求给组内其他同事，开启review环节。</p>
<p>&emsp;&emsp;如果有相关的issue在code review都已经结束，则会在gitlab上关闭merge request，这个时候代码会自动合并到master分支，并在5分钟以内被部署到生产环境上。</p>
<h3 id="工作在持续集成中的特点">工作在持续集成中的特点</h3>
<ol>
<li>源代码管理工具，如git，svn等</li>
<li>持续集成工具，如Jenkins</li>
<li>频繁地代码提交和测试</li>
<li>细颗粒度的issue管理，保证每一个issue的开发周期在一两天完成</li>
<li>流程自动化的code review</li>
<li>自动和频繁的代码合并和部署</li>
</ol>
<h2 id="持续集成的优与劣">持续集成的优与劣</h2>
<h3 id="优点">优点</h3>
<p>&emsp;&emsp;持续集成的优点是比较明显的，频繁的提交带来频繁地集成，把代码问题的暴露大大提前了，并且由于流程的自动化，让开发者更好地关注于开发本身。</p>
<p>&emsp;&emsp;对于较大的项目，或者开发者分散的项目，好的持续集成策略能够极大地降低沟通成本和集成成本。</p>
<h3 id="风险">风险</h3>
<p>&emsp;&emsp;采用持续集成需要维护的工具较多，至少包括源代码管理工具如git，持续集成工具如Jenkins，并且需要制定相应的规则保证每一个持续集成job都正确地工作。这中间需要较多地沟通和适应成本，对于一个开发频率不高的项目，这种做法性价比不高。</p>
<p>&emsp;&emsp;并不是有git和jenkins就可以称为持续集成的，要完整地搭建一套可工作的持续集成框架，需要研发测试等各个组织的努力，如果处理不好，可能适得其反。</p>
<h3 id="基于gitlab的持续集成策略">基于gitlab的持续集成策略</h3>
<p>&emsp;&emsp;下图是笔者所在团队基于gitlab的持续集成策略，这里面的测试只有一轮，集成也只有一轮，对于更复杂的多轮集成的情况，我们后面再谈。</p>
<p><img src="/images/dev_process.png" alt="gitlab dev process"></p>
<h2 id="多轮持续集成模型">多轮持续集成模型</h2>
<p>&emsp;&emsp;如果产品比较复杂，如通信产品，单靠单元测试显然不能满足需求，这个时候往往会有多轮测试，并且在整个产品集成前后都会有单独的测试被执行。以笔者所在公司为例，一个通信产品往往能分为平台和应用等几大块，对每一块来说，产品交付到客户手中至少需要经历：单元测试、基于真实设备或模拟器的功能测试（编包前）、编包测试、编包后的基本功能测试、包的回归测试、系统集成测试等这几个环节。两个环节间的联系有的是代码的版本，有的则是包的版本。而越到测试的后期，测试的成本就越高，测试周期也越长。理想的情况是每一个阶段的集成测试都可以自动的转入下一阶段，并根据时间、频率等具体情况来决定测试频率，一个开发人员的代码提交可以在整个流程中被自动追溯，而产品的质量也可以在整个流程中被度量和追溯。而整个流程也就类似下图的continuous delivery或者continuous deployment了。</p>
<p><img src="/images/continuous_delivery.jpg" alt="continuous delivery"></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
    <a href="/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/3/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:feiyuw.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/家庭/">家庭</a><small>1</small></li>
  
    <li><a href="/categories/持续集成/">持续集成</a><small>2</small></li>
  
    <li><a href="/categories/教育/">教育</a><small>1</small></li>
  
    <li><a href="/categories/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/categories/测试自动化/">测试自动化</a><small>1</small></li>
  
    <li><a href="/categories/读书/">读书</a><small>2</small></li>
  
    <li><a href="/categories/软件开发/">软件开发</a><small>4</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Gitlab/">Gitlab</a><small>1</small></li>
  
    <li><a href="/tags/NodeJS/">NodeJS</a><small>1</small></li>
  
    <li><a href="/tags/Ruby-On-Rails/">Ruby On Rails</a><small>1</small></li>
  
    <li><a href="/tags/TA/">TA</a><small>1</small></li>
  
    <li><a href="/tags/VIM/">VIM</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/女儿/">女儿</a><small>1</small></li>
  
    <li><a href="/tags/家庭/">家庭</a><small>1</small></li>
  
    <li><a href="/tags/持续集成/">持续集成</a><small>3</small></li>
  
    <li><a href="/tags/效率/">效率</a><small>1</small></li>
  
    <li><a href="/tags/教育/">教育</a><small>1</small></li>
  
    <li><a href="/tags/数学/">数学</a><small>1</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/美食/">美食</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 feiyuw
  
</div>
<div class="clearfix"></div></footer>
  <script src="//cdnjscn.b0.upaiyun.com/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>