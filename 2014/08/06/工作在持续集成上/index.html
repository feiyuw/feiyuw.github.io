<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>工作在持续集成上 | 张裕的博客</title>
  <meta name="author" content="feiyuw">
  
  <meta name="description" content="Test Automation, Continuous Delivery, Node.js, Python and VIM">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="工作在持续集成上"/>
  <meta property="og:site_name" content="张裕的博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="张裕的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">张裕的博客</a></h1>
  <h2><a href="/">大音希声，大象希行</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">存档</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-06T06:14:45.000Z"><a href="/2014/08/06/工作在持续集成上/">2014-08-06</a></time>
      
      
  
    <h1 class="title">工作在持续集成上</h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;最近这几年一直在与持续集成及其相关的工作打交道，包括我自己的日常工作，目前也在这个工作模式里面进行。这篇博客想通过一天的工作来聊一下这种工作模式，它的优点以及弊端。</p>
<h2 id="什么是持续集成">什么是持续集成</h2>
<p>&emsp;&emsp;摘录自Martin Fowler的<a href="http://www.martinfowler.com/articles/continuousIntegration.html" target="_blank" rel="external">大作</a>：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>Continuous Integration <span class="keyword">is</span> a software development practice <span class="keyword">where</span> members <span class="keyword">of</span> a team integrate their 
work frequently, usually each person integrates <span class="keyword">at</span> least daily - leading <span class="keyword">to</span> multiple integrations 
per <span class="property">day</span>. Each integration <span class="keyword">is</span> verified <span class="keyword">by</span> an automated build (including test) <span class="keyword">to</span> detect integration 
errors <span class="keyword">as</span> quickly <span class="keyword">as</span> possible. Many teams find <span class="keyword">that</span> this approach leads <span class="keyword">to</span> significantly reduced 
integration problems <span class="keyword">and</span> allows a team <span class="keyword">to</span> develop cohesive software more rapidly. This article <span class="keyword">is</span> 
a quick overview <span class="keyword">of</span> Continuous Integration summarizing <span class="keyword">the</span> technique <span class="keyword">and</span> <span class="keyword">its</span> current usage.
</pre></td></tr></table></figure>

<p>&emsp;&emsp;简而言之，持续集成就是让项目团队中的每一个人都尽可能频繁地把他们的工作集成到产品中进行验证，获得反馈的一种工作模式。</p>
<h2 id="在持续集成中工作">在持续集成中工作</h2>
<p>&emsp;&emsp;在这里笔者描述一下一天的工作情况。笔者所在的团队很小，所做的工作以开发内部工具为主，采用gitlab来管理代码和issue，以及进行code review。</p>
<p>&emsp;&emsp;早上到公司，第一件事一般是打开邮箱，查看有没有新的code review请求发过来。如果有的话，会在打开对应的merge request，进行code review，gitlab会自动把这些review结果发送给其他人。处理完这些事情后，如果有未做完的issue，会接着昨天的工作继续开发。如果昨天的issue已经结束并通过review，则会在gitlab上找下一个优先级的issue，将它的assiner改成自己，然后为这个issue创建分支，开始在这个分支上进行开发。</p>
<p>&emsp;&emsp;通常情况下，上午的两三个小时时间主要用在code review和日常的交流回复上面，下午4：00前是主要的开发时间，在本地UT通过后，就会提交到gitlab上。然后创建一个merge request，这个时候CI系统会侦测到这次提交，并自动执行单元测试，代码静态分析等，如果其中一个测试失败，笔者会收到相关的邮件。然后就是修复这些问题，再次提交。</p>
<p>&emsp;&emsp;下班前的半个小时是组内的日常会议时间，主要是交流各自进度和遇到的问题。</p>
<p>&emsp;&emsp;如果所选的issue开发已经结束，并且通过CI系统测试，就会发一个code review的请求给组内其他同事，开启review环节。</p>
<p>&emsp;&emsp;如果有相关的issue在code review都已经结束，则会在gitlab上关闭merge request，这个时候代码会自动合并到master分支，并在5分钟以内被部署到生产环境上。</p>
<h3 id="工作在持续集成中的特点">工作在持续集成中的特点</h3>
<ol>
<li>源代码管理工具，如git，svn等</li>
<li>持续集成工具，如Jenkins</li>
<li>频繁地代码提交和测试</li>
<li>细颗粒度的issue管理，保证每一个issue的开发周期在一两天完成</li>
<li>流程自动化的code review</li>
<li>自动和频繁的代码合并和部署</li>
</ol>
<h2 id="持续集成的优与劣">持续集成的优与劣</h2>
<h3 id="优点">优点</h3>
<p>&emsp;&emsp;持续集成的优点是比较明显的，频繁的提交带来频繁地集成，把代码问题的暴露大大提前了，并且由于流程的自动化，让开发者更好地关注于开发本身。</p>
<p>&emsp;&emsp;对于较大的项目，或者开发者分散的项目，好的持续集成策略能够极大地降低沟通成本和集成成本。</p>
<h3 id="风险">风险</h3>
<p>&emsp;&emsp;采用持续集成需要维护的工具较多，至少包括源代码管理工具如git，持续集成工具如Jenkins，并且需要制定相应的规则保证每一个持续集成job都正确地工作。这中间需要较多地沟通和适应成本，对于一个开发频率不高的项目，这种做法性价比不高。</p>
<p>&emsp;&emsp;并不是有git和jenkins就可以称为持续集成的，要完整地搭建一套可工作的持续集成框架，需要研发测试等各个组织的努力，如果处理不好，可能适得其反。</p>
<h3 id="基于gitlab的持续集成策略">基于gitlab的持续集成策略</h3>
<p>&emsp;&emsp;下图是笔者所在团队基于gitlab的持续集成策略，这里面的测试只有一轮，集成也只有一轮，对于更复杂的多轮集成的情况，我们后面再谈。</p>
<p><img src="/images/dev_process.png" alt="gitlab dev process"></p>
<h2 id="多轮持续集成模型">多轮持续集成模型</h2>
<p>&emsp;&emsp;如果产品比较复杂，如通信产品，单靠单元测试显然不能满足需求，这个时候往往会有多轮测试，并且在整个产品集成前后都会有单独的测试被执行。以笔者所在公司为例，一个通信产品往往能分为平台和应用等几大块，对每一块来说，产品交付到客户手中至少需要经历：单元测试、基于真实设备或模拟器的功能测试（编包前）、编包测试、编包后的基本功能测试、包的回归测试、系统集成测试等这几个环节。两个环节间的联系有的是代码的版本，有的则是包的版本。而越到测试的后期，测试的成本就越高，测试周期也越长。理想的情况是每一个阶段的集成测试都可以自动的转入下一阶段，并根据时间、频率等具体情况来决定测试频率，一个开发人员的代码提交可以在整个流程中被自动追溯，而产品的质量也可以在整个流程中被度量和追溯。而整个流程也就类似下图的continuous delivery或者continuous deployment了。</p>
<p><img src="/images/continuous_delivery.jpg" alt="continuous delivery"></p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/持续集成/">持续集成</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/持续集成/">持续集成</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


     <nav id="pagination" >
        
        <a href="/2014/08/06/基于gitlab-merge-request的持续集成/" class="alignleft prev" >上一页</a>
        
        
        <a href="/2014/07/18/测试自动化方案的选择/" class="alignright next" >下一页</a>
        
        <div class="clearfix"></div>
    </nav>

    <section id="comment">
    <!-- 多说评论框 start -->
        <div class="ds-thread" data-thread-key="/2014/08/06/工作在持续集成上/" data-title="工作在持续集成上" data-url="http://feiyuw.github.io/2014/08/06/工作在持续集成上/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"feiyuw"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
    <!-- 多说公共JS代码 end -->
    </section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:feiyuw.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/家庭/">家庭</a><small>1</small></li>
  
    <li><a href="/categories/持续集成/">持续集成</a><small>2</small></li>
  
    <li><a href="/categories/教育/">教育</a><small>1</small></li>
  
    <li><a href="/categories/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/categories/测试自动化/">测试自动化</a><small>1</small></li>
  
    <li><a href="/categories/读书/">读书</a><small>2</small></li>
  
    <li><a href="/categories/软件开发/">软件开发</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Ruby-On-Rails/">Ruby On Rails</a><small>1</small></li>
  
    <li><a href="/tags/TA/">TA</a><small>1</small></li>
  
    <li><a href="/tags/女儿/">女儿</a><small>1</small></li>
  
    <li><a href="/tags/家庭/">家庭</a><small>1</small></li>
  
    <li><a href="/tags/持续集成/">持续集成</a><small>3</small></li>
  
    <li><a href="/tags/教育/">教育</a><small>1</small></li>
  
    <li><a href="/tags/数学/">数学</a><small>1</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/美食/">美食</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 feiyuw
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- google analysis -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53705106-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>