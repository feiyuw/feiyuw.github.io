<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>基于gitlab merge request的持续集成 | 张裕的博客</title>
  <meta name="author" content="feiyuw">
  
  <meta name="description" content="Test Automation, Continuous Delivery, Node.js, Python and VIM">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="基于gitlab merge request的持续集成"/>
  <meta property="og:site_name" content="张裕的博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="张裕的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">张裕的博客</a></h1>
  <h2><a href="/">大音希声，大象希行</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">存档</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-08-06T06:30:41.000Z"><a href="/2014/08/06/基于gitlab-merge-request的持续集成/">2014-08-06</a></time>
      
      
  
    <h1 class="title">基于gitlab merge request的持续集成</h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;Gitlab可以认为是github的开源实现，基于它来构建开发流程可以带给我们类似github的体验，尤其是基于merge request进行测试和代码评审，是开发者间合作的一种很好的方式。本文就谈一下怎么基于gitlab merge request来进行持续集成和工作。</p>
<p>&emsp;&emsp;先谈一下我们用到的工具：</p>
<ul>
<li>Jenkins</li>
<li>git plugin</li>
<li>gitlab merge request builder plugin</li>
</ul>
<p>&emsp;&emsp;然后准备一台Linux的PC用来安装Jenkins就可以了。</p>
<h2 id="第一步：获取Jenkins，启动Jenkins">第一步：获取Jenkins，启动Jenkins</h2>
<ol>
<li>从 <a href="http://jenkins-ci.org" target="_blank" rel="external">http://jenkins-ci.org</a> 上下载最新的jenkins.war文件</li>
<li>java -jar jenkins.war启动Jenkins，可以添加一下启动参数，设置端口和log地址等，如我实际使用的启动脚本如下：<figure class="highlight sh"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash
</span>
<span class="keyword">export</span> JENKINS_HOME=/opt/jenkins_home/
java -Duser.timezone=<span class="string">"Asia/Shanghai"</span> -Dorg.apache.commons.jelly.tags.fmt.timeZone=<span class="string">'Asia/Shanghai'</span> -jar /opt/jenkins_home/jenkins.war --daemon --prefix=/jenkins --logfile=/opt/jenkins_home/logs/jenkins.log
</pre></td></tr></table></figure></li>
<li>打开 <a href="http://localhost:8080/jenkins" target="_blank" rel="external">http://localhost:8080/jenkins</a> 来使用它</li>
</ol>
<h2 id="第二步：安装git_plugin，gitlab_merge_request_builder_plugin">第二步：安装git plugin，gitlab merge request builder plugin</h2>
<ol>
<li>打开 <a href="http://localhost:8080/jenkins/pluginManager/" target="_blank" rel="external">http://localhost:8080/jenkins/pluginManager/</a> 选择Git Plugin和Gitlab Merge Request Builder Plugin，点击安装</li>
<li>重启jenkins</li>
<li>安装完成</li>
</ol>
<h2 id="第三步：全局配置">第三步：全局配置</h2>
<ol>
<li>打开 <a href="http://localhost:8080/jenkins/configure" target="_blank" rel="external">http://localhost:8080/jenkins/configure</a> ，配置<strong>Gitlab Merge Request Builder</strong></li>
<li>设置Gitlab Host URL为你的gitlab服务器地址</li>
<li>设置Jenkins Username，为你登录gitlab服务器的用户名</li>
<li>设置Jenkins API Token，必须和Jenkins Username匹配</li>
<li>其他设置默认就可以了</li>
</ol>
<p><img src="/images/gitlab_global.png" alt="gitlab全局配置"></p>
<h2 id="第四步：配置Job">第四步：配置Job</h2>
<ol>
<li>新建一个job，配置Git，见下图，除了Repository URL，其它照抄就可以了<br> <img src="/images/git_config.png" alt="git config"></li>
<li>配置Gitlab Merge Request Builder，注意设置Gitlab Project Path<br> <img src="/images/gitlab_mr_config.png" alt="gitlab merge request builder"></li>
</ol>
<h2 id="测试">测试</h2>
<ol>
<li>配置好测试的脚本和slave等，然后创建一个merge request，等待Jenkins的自动触发吧</li>
<li>一个配置正确的job，触发的历史记录类似下图<br> <img src="/images/gitlab_mr_builds.png" alt="gitlab builds"></li>
<li>某一个具体的build的触发情况如下图，可以看到触发源是gitlab merge request，源branch和目标branch的信息，以及commit版本信息等<br> <img src="/images/gitlab_mr_build_cause.png" alt="gitlab build detail"></li>
</ol>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/持续集成/">持续集成</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/持续集成/">持续集成</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


     <nav id="pagination" >
        
        <a href="/2014/08/11/我家女儿三岁半/" class="alignleft prev" >上一页</a>
        
        
        <a href="/2014/08/06/工作在持续集成上/" class="alignright next" >下一页</a>
        
        <div class="clearfix"></div>
    </nav>

    <section id="comment">
    <!-- 多说评论框 start -->
        <div class="ds-thread" data-thread-key="/2014/08/06/基于gitlab-merge-request的持续集成/" data-title="基于gitlab merge request的持续集成" data-url="http://feiyuw.github.io/2014/08/06/基于gitlab-merge-request的持续集成/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"feiyuw"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
    <!-- 多说公共JS代码 end -->
    </section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:feiyuw.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/家庭/">家庭</a><small>1</small></li>
  
    <li><a href="/categories/持续集成/">持续集成</a><small>2</small></li>
  
    <li><a href="/categories/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/categories/测试自动化/">测试自动化</a><small>1</small></li>
  
    <li><a href="/categories/读书/">读书</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/TA/">TA</a><small>1</small></li>
  
    <li><a href="/tags/女儿/">女儿</a><small>1</small></li>
  
    <li><a href="/tags/家庭/">家庭</a><small>1</small></li>
  
    <li><a href="/tags/持续集成/">持续集成</a><small>2</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 feiyuw
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- google analysis -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53705106-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>